import base64,codecs
exec(base64.b64decode("IyBTdGFyIFN0ZWFsZXIgLSBSZWFkeSB0byBydW4gUHl0aG9uIHZlcnNpb24KIyBUZWxlZ3JhbSBDMiB3aXRoIGxvZ2dpbmcgc3VwcG9ydAojIFB5dGhvbiAzLjEwKyB8IFdpbmRvd3MgT25seQoKIyA9PT09PT09PT09PT09PSBBVVRPIElOU1RBTEwgREVQRU5ERU5DSUVTID09PT09PT09PT09PT09CmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUKaW1wb3J0IHNvY2tldAoKZGVmIGlzX2Nvbm5lY3RlZCgpOgogICAgIiIi0J/RgNC+0LLQtdGA0Y/QtdGCINC/0L7QtNC60LvRjtGH0LXQvdC40LUg0Log0LjQvdGC0LXRgNC90LXRgtGDIiIiCiAgICB0cnk6CiAgICAgICAgc29ja2V0LmNyZWF0ZV9jb25uZWN0aW9uKCgiOC44LjguOCIsIDUzKSwgdGltZW91dD0zKQogICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgd2FpdF9mb3JfaW50ZXJuZXQoY2hlY2tfaW50ZXJ2YWw9NSk6CiAgICAiIiLQltC00ZHRgiDQv9C+0LTQutC70Y7Rh9C10L3QuNGPINC6INC40L3RgtC10YDQvdC10YLRgyIiIgogICAgd2hpbGUgbm90IGlzX2Nvbm5lY3RlZCgpOgogICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpCgpkZWYgaW5zdGFsbF9wYWNrYWdlKHBhY2thZ2UpOgogICAgIiIi0JDQstGC0L7QvNCw0YLQuNGH0LXRgdC60LDRjyDRg9GB0YLQsNC90L7QstC60LAg0L/QsNC60LXRgtC+0LIg0YEg0L7QttC40LTQsNC90LjQtdC8INC40L3RgtC10YDQvdC10YLQsCIiIgogICAgd2FpdF9mb3JfaW50ZXJuZXQoKQogICAgdHJ5OgogICAgICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICItbSIsICJwaXAiLCAiaW5zdGFsbCIsIHBhY2thZ2UsICItcSIsICItLWRpc2FibGUtcGlwLXZlcnNpb24tY2hlY2siXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLkRFVk5VTEwsIHN0ZGVycj1zdWJwcm9jZXNzLkRFVk5VTEwpCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwoKIyDQltC00ZHQvCDQuNC90YLQtdGA0L3QtdGCINC/0LXRgNC10LQg0YPRgdGC0LDQvdC+0LLQutC+0LkKd2FpdF9mb3JfaW50ZXJuZXQoKQoKIyDQodC/0LjRgdC+0Log0L3QtdC+0LHRhdC+0LTQuNC80YvRhSDQv9Cw0LrQtdGC0L7QsgpyZXF1aXJlZF9wYWNrYWdlcyA9IFsicHlhZXMiXQoKZm9yIHBrZyBpbiByZXF1aXJlZF9wYWNrYWdlczoKICAgIHRyeToKICAgICAgICBfX2ltcG9ydF9fKHBrZykKICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICBpbnN0YWxsX3BhY2thZ2UocGtnKQoKIyA9PT09PT09PT09PT09PSBJTVBPUlRTID09PT09PT09PT09PT09CmltcG9ydCBiYXNlNjQKaW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCByYW5kb20KaW1wb3J0IHNodXRpbAppbXBvcnQgc3FsaXRlMwppbXBvcnQgcmUKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgdGltZQppbXBvcnQgY3R5cGVzCmltcG9ydCBsb2dnaW5nCmltcG9ydCB6bGliCmltcG9ydCBpbwpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIHRocmVhZGluZyBpbXBvcnQgVGhyZWFkCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IHVybG9wZW4sIFJlcXVlc3QKZnJvbSB1cmxsaWIucGFyc2UgaW1wb3J0IHF1b3RlCmZyb20gdXJsbGliLmVycm9yIGltcG9ydCBVUkxFcnJvcgoKIyA9PT09PT09PT09PT09PSBURUxFR1JBTSBDT05GSUdVUkFUSU9OID09PT09PT09PT09PT09ClRFTEVHUkFNX1RPS0VOID0gIjcwODc5MDkxMTg6QUFHeUFnb1VLYjJpRUFfV1dXRFRTTkFqUl80aE94SEEyamciClRFTEVHUkFNX0NIQVRfSUQgPSAiMTA1NjE0ODk0NyIKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpjbGFzcyBUZWxlZ3JhbUxvZ2dlcjoKICAgICIiItCe0YLQv9GA0LDQstC70Y/QtdGCINC70L7Qs9C4INCyIFRlbGVncmFtIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0b2tlbjogc3RyLCBjaGF0X2lkOiBzdHIpOgogICAgICAgIHNlbGYudG9rZW4gPSB0b2tlbgogICAgICAgIHNlbGYuY2hhdF9pZCA9IGNoYXRfaWQKICAgICAgICBzZWxmLmxvZ19idWZmZXIgPSBbXQogICAgICAgIHNlbGYuZW5hYmxlZCA9IFRydWUKICAgIAogICAgZGVmIF9zZW5kX21lc3NhZ2Uoc2VsZiwgdGV4dDogc3RyLCBwYXJzZV9tb2RlOiBzdHIgPSAiSFRNTCIpIC0+IGJvb2w6CiAgICAgICAgIiIi0J7RgtC/0YDQsNCy0LvRj9C10YIg0YHQvtC+0LHRidC10L3QuNC1INCyIFRlbGVncmFtIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3R7c2VsZi50b2tlbn0vc2VuZE1lc3NhZ2UiCiAgICAgICAgICAgIGRhdGEgPSBqc29uLmR1bXBzKHsKICAgICAgICAgICAgICAgICJjaGF0X2lkIjogc2VsZi5jaGF0X2lkLAogICAgICAgICAgICAgICAgInRleHQiOiB0ZXh0Wzo0MDk2XSwgICMgVGVsZWdyYW0gbGltaXQKICAgICAgICAgICAgICAgICJwYXJzZV9tb2RlIjogcGFyc2VfbW9kZQogICAgICAgICAgICB9KS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlcSA9IFJlcXVlc3QodXJsLCBkYXRhPWRhdGEsIGhlYWRlcnM9eyJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9KQogICAgICAgICAgICB3aXRoIHVybG9wZW4ocmVxLCB0aW1lb3V0PTEwKSBhcyByZXNwb25zZToKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMgPT0gMjAwCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIltURyBFcnJvcl0ge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBfc2VuZF9kb2N1bWVudChzZWxmLCBmaWxlX3BhdGg6IHN0ciwgY2FwdGlvbjogc3RyID0gIiIpIC0+IGJvb2w6CiAgICAgICAgIiIi0J7RgtC/0YDQsNCy0LvRj9C10YIg0YTQsNC50Lsg0LIgVGVsZWdyYW0iIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCB1cmxsaWIucmVxdWVzdAogICAgICAgICAgICBpbXBvcnQgbWltZXR5cGVzCiAgICAgICAgICAgIAogICAgICAgICAgICBib3VuZGFyeSA9ICctLS0tV2ViS2l0Rm9ybUJvdW5kYXJ5JyArICcnLmpvaW4ocmFuZG9tLmNob2ljZXMoJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Jywgaz0xNikpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAncmInKSBhcyBmOgogICAgICAgICAgICAgICAgZmlsZV9kYXRhID0gZi5yZWFkKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbGVuYW1lID0gb3MucGF0aC5iYXNlbmFtZShmaWxlX3BhdGgpCiAgICAgICAgICAgIAogICAgICAgICAgICBib2R5ID0gKAogICAgICAgICAgICAgICAgZictLXtib3VuZGFyeX1cclxuJwogICAgICAgICAgICAgICAgZidDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9ImNoYXRfaWQiXHJcblxyXG57c2VsZi5jaGF0X2lkfVxyXG4nCiAgICAgICAgICAgICAgICBmJy0te2JvdW5kYXJ5fVxyXG4nCiAgICAgICAgICAgICAgICBmJ0NvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT0iY2FwdGlvbiJcclxuXHJcbntjYXB0aW9ufVxyXG4nCiAgICAgICAgICAgICAgICBmJy0te2JvdW5kYXJ5fVxyXG4nCiAgICAgICAgICAgICAgICBmJ0NvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT0iZG9jdW1lbnQiOyBmaWxlbmFtZT0ie2ZpbGVuYW1lfSJcclxuJwogICAgICAgICAgICAgICAgZidDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVxyXG5cclxuJwogICAgICAgICAgICApLmVuY29kZSgndXRmLTgnKSArIGZpbGVfZGF0YSArIGYnXHJcbi0te2JvdW5kYXJ5fS0tXHJcbicuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgICAgIAogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3R7c2VsZi50b2tlbn0vc2VuZERvY3VtZW50IgogICAgICAgICAgICByZXEgPSBSZXF1ZXN0KHVybCwgZGF0YT1ib2R5KQogICAgICAgICAgICByZXEuYWRkX2hlYWRlcignQ29udGVudC1UeXBlJywgZidtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT17Ym91bmRhcnl9JykKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggdXJsb3BlbihyZXEsIHRpbWVvdXQ9NjApIGFzIHJlc3BvbnNlOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cyA9PSAyMDAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiW1RHIERvY3VtZW50IEVycm9yXSB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGxvZyhzZWxmLCBsZXZlbDogc3RyLCBtZXNzYWdlOiBzdHIpOgogICAgICAgICIiItCU0L7QsdCw0LLQu9GP0LXRgiDQu9C+0LMg0LIg0LHRg9GE0LXRgCDQuCDQstGL0LLQvtC00LjRgiDQsiDQutC+0L3RgdC+0LvRjCIiIgogICAgICAgIHRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgbG9nX2VudHJ5ID0gZiJbe3RpbWVzdGFtcH1dIFt7bGV2ZWx9XSB7bWVzc2FnZX0iCiAgICAgICAgc2VsZi5sb2dfYnVmZmVyLmFwcGVuZChsb2dfZW50cnkpCiAgICAgICAgcHJpbnQobG9nX2VudHJ5KQogICAgCiAgICBkZWYgaW5mbyhzZWxmLCBtZXNzYWdlOiBzdHIpOgogICAgICAgIHNlbGYubG9nKCJJTkZPIiwgbWVzc2FnZSkKICAgIAogICAgZGVmIHdhcm5pbmcoc2VsZiwgbWVzc2FnZTogc3RyKToKICAgICAgICBzZWxmLmxvZygiV0FSTklORyIsIG1lc3NhZ2UpCiAgICAKICAgIGRlZiBlcnJvcihzZWxmLCBtZXNzYWdlOiBzdHIpOgogICAgICAgIHNlbGYubG9nKCJFUlJPUiIsIG1lc3NhZ2UpCiAgICAKICAgIGRlZiBzZW5kX3N0YXJ0dXBfbm90aWZpY2F0aW9uKHNlbGYpOgogICAgICAgICIiItCe0YLQv9GA0LDQstC70Y/QtdGCINGD0LLQtdC00L7QvNC70LXQvdC40LUg0L4g0LfQsNC/0YPRgdC60LUiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbXB1dGVyX25hbWUgPSBvcy5nZXRlbnYoImNvbXB1dGVybmFtZSIsICJVbmtub3duIikKICAgICAgICAgICAgdXNlcm5hbWUgPSBvcy5nZXRsb2dpbigpCiAgICAgICAgICAgIAogICAgICAgICAgICBtZXNzYWdlID0gKAogICAgICAgICAgICAgICAgIvCfmoAgPGI+U3RhciBTdGVhbGVyIFN0YXJ0ZWQ8L2I+XG5cbiIKICAgICAgICAgICAgICAgIGYi8J+RpCA8Yj5Vc2VyOjwvYj4gPGNvZGU+e3VzZXJuYW1lfTwvY29kZT5cbiIKICAgICAgICAgICAgICAgIGYi8J+SuyA8Yj5Db21wdXRlcjo8L2I+IDxjb2RlPntjb21wdXRlcl9uYW1lfTwvY29kZT5cbiIKICAgICAgICAgICAgICAgIGYi8J+VkCA8Yj5UaW1lOjwvYj4gPGNvZGU+e2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfTwvY29kZT4iCiAgICAgICAgICAgICkKICAgICAgICAgICAgc2VsZi5fc2VuZF9tZXNzYWdlKG1lc3NhZ2UpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIltTdGFydHVwIG5vdGlmaWNhdGlvbiBlcnJvcl0ge2V9IikKICAgIAogICAgZGVmIHNlbmRfbG9ncyhzZWxmKToKICAgICAgICAiIiLQntGC0L/RgNCw0LLQu9GP0LXRgiDQvdCw0LrQvtC/0LvQtdC90L3Ri9C1INC70L7Qs9C4INCyIFRlbGVncmFtIiIiCiAgICAgICAgaWYgbm90IHNlbGYubG9nX2J1ZmZlcjoKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgbG9nc190ZXh0ID0gIlxuIi5qb2luKHNlbGYubG9nX2J1ZmZlclstNTA6XSkgICMg0J/QvtGB0LvQtdC00L3QuNC1IDUwINC30LDQv9C40YHQtdC5CiAgICAgICAgbWVzc2FnZSA9IGYi8J+TiyA8Yj5FeGVjdXRpb24gTG9nczwvYj5cblxuPHByZT57bG9nc190ZXh0WzozODAwXX08L3ByZT4iCiAgICAgICAgc2VsZi5fc2VuZF9tZXNzYWdlKG1lc3NhZ2UpCiAgICAKICAgIGRlZiBzZW5kX2NvbXBsZXRpb25fbm90aWZpY2F0aW9uKHNlbGYsIHN0YXRzOiBkaWN0KToKICAgICAgICAiIiLQntGC0L/RgNCw0LLQu9GP0LXRgiDRg9Cy0LXQtNC+0LzQu9C10L3QuNC1INC+INC30LDQstC10YDRiNC10L3QuNC4INGBINGB0YLQsNGC0LjRgdGC0LjQutC+0LkiIiIKICAgICAgICBzdGF0c190ZXh0ID0gIlxuIi5qb2luKFtmIuKAoiB7a306IHt2fSIgZm9yIGssIHYgaW4gc3RhdHMuaXRlbXMoKV0pCiAgICAgICAgbWVzc2FnZSA9ICgKICAgICAgICAgICAgIuKchSA8Yj5TdGFyIFN0ZWFsZXIgQ29tcGxldGVkPC9iPlxuXG4iCiAgICAgICAgICAgIGYi8J+TiiA8Yj5TdGF0aXN0aWNzOjwvYj5cbjxwcmU+e3N0YXRzX3RleHR9PC9wcmU+IgogICAgICAgICkKICAgICAgICBzZWxmLl9zZW5kX21lc3NhZ2UobWVzc2FnZSkKICAgIAogICAgZGVmIHNlbmRfZXJyb3Jfbm90aWZpY2F0aW9uKHNlbGYsIGVycm9yOiBzdHIpOgogICAgICAgICIiItCe0YLQv9GA0LDQstC70Y/QtdGCINGD0LLQtdC00L7QvNC70LXQvdC40LUg0L7QsSDQvtGI0LjQsdC60LUiIiIKICAgICAgICBtZXNzYWdlID0gZiLinYwgPGI+RXJyb3Igb2NjdXJyZWQ8L2I+XG5cbjxwcmU+e2Vycm9yWzozODAwXX08L3ByZT4iCiAgICAgICAgc2VsZi5fc2VuZF9tZXNzYWdlKG1lc3NhZ2UpCiAgICAKICAgIGRlZiBzZW5kX2ZpbGUoc2VsZiwgZmlsZV9wYXRoOiBzdHIsIGNhcHRpb246IHN0ciA9ICIiKToKICAgICAgICAiIiLQntGC0L/RgNCw0LLQu9GP0LXRgiDRhNCw0LnQuyDQsiBUZWxlZ3JhbSIiIgogICAgICAgIHJldHVybiBzZWxmLl9zZW5kX2RvY3VtZW50KGZpbGVfcGF0aCwgY2FwdGlvbikKCgojINCT0LvQvtCx0LDQu9GM0L3Ri9C5INC70L7Qs9Cz0LXRgAp0Z19sb2dnZXIgPSBUZWxlZ3JhbUxvZ2dlcihURUxFR1JBTV9UT0tFTiwgVEVMRUdSQU1fQ0hBVF9JRCkKCgpjbGFzcyBTZXR0aW5nczoKICAgIEMyID0gKDEsIGYie1RFTEVHUkFNX1RPS0VOfSR7VEVMRUdSQU1fQ0hBVF9JRH0iKQogICAgTXV0ZXggPSAiU3RhclN0ZWFsZXJfIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZXMoJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OScsIGs9MTYpKQogICAgUGluZ01lID0gRmFsc2UKICAgIFZtcHJvdGVjdCA9IEZhbHNlCiAgICBTdGFydHVwID0gVHJ1ZQogICAgTWVsdCA9IEZhbHNlCiAgICBVYWNCeXBhc3MgPSBUcnVlCiAgICBBcmNoaXZlUGFzc3dvcmQgPSAic3RhcjEyMyIKICAgIEhpZGVDb25zb2xlID0gVHJ1ZSAgIyDQodC60YDRi9Cy0LDQtdGCINC60L7QvdGB0L7Qu9GMINC/0YDQuCDQt9Cw0L/Rg9GB0LrQtQogICAgRGVidWcgPSBUcnVlICAjINCS0LrQu9GO0YfQsNC10Lwg0LvQvtCz0LjRgNC+0LLQsNC90LjQtQogICAgUnVuQm91bmRPblN0YXJ0dXAgPSBGYWxzZQoKICAgIENhcHR1cmVXZWJjYW0gPSBGYWxzZQogICAgQ2FwdHVyZVBhc3N3b3JkcyA9IFRydWUKICAgIENhcHR1cmVDb29raWVzID0gVHJ1ZQogICAgQ2FwdHVyZUF1dG9maWxscyA9IFRydWUKICAgIENhcHR1cmVIaXN0b3J5ID0gVHJ1ZQogICAgQ2FwdHVyZURpc2NvcmRUb2tlbnMgPSBUcnVlCiAgICBDYXB0dXJlR2FtZXMgPSBUcnVlCiAgICBDYXB0dXJlV2lmaVBhc3N3b3JkcyA9IFRydWUKICAgIENhcHR1cmVTeXN0ZW1JbmZvID0gVHJ1ZQogICAgQ2FwdHVyZVNjcmVlbnNob3QgPSBUcnVlCiAgICBDYXB0dXJlVGVsZWdyYW0gPSBUcnVlCiAgICBDYXB0dXJlQ29tbW9uRmlsZXMgPSBUcnVlCiAgICBDYXB0dXJlV2FsbGV0cyA9IFRydWUKCiAgICBGYWtlRXJyb3IgPSAoRmFsc2UsICgiRXJyb3IiLCAiQXBwbGljYXRpb24gZmFpbGVkIHRvIHN0YXJ0IiwgMCkpCiAgICBCbG9ja0F2U2l0ZXMgPSBUcnVlCiAgICBEaXNjb3JkSW5qZWN0aW9uID0gRmFsc2UKCgppZiBub3QgaGFzYXR0cihzeXMsICJfTUVJUEFTUyIpOgogICAgc3lzLl9NRUlQQVNTID0gb3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykpCgoKY2xhc3MgU3lzY2FsbHM6CiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgQ3J5cHRVbnByb3RlY3REYXRhKGVuY3J5cHRlZF9kYXRhOiBieXRlcywgb3B0aW9uYWxfZW50cm9weTogc3RyID0gTm9uZSkgLT4gYnl0ZXM6CiAgICAgICAgY2xhc3MgREFUQV9CTE9CKGN0eXBlcy5TdHJ1Y3R1cmUpOgogICAgICAgICAgICBfZmllbGRzXyA9IFsKICAgICAgICAgICAgICAgICgiY2JEYXRhIiwgY3R5cGVzLmNfdWxvbmcpLAogICAgICAgICAgICAgICAgKCJwYkRhdGEiLCBjdHlwZXMuUE9JTlRFUihjdHlwZXMuY191Ynl0ZSkpCiAgICAgICAgICAgIF0KICAgICAgICAKICAgICAgICBwRGF0YUluID0gREFUQV9CTE9CKGxlbihlbmNyeXB0ZWRfZGF0YSksIGN0eXBlcy5jYXN0KGVuY3J5cHRlZF9kYXRhLCBjdHlwZXMuUE9JTlRFUihjdHlwZXMuY191Ynl0ZSkpKQogICAgICAgIHBEYXRhT3V0ID0gREFUQV9CTE9CKCkKICAgICAgICBwT3B0aW9uYWxFbnRyb3B5ID0gTm9uZQoKICAgICAgICBpZiBvcHRpb25hbF9lbnRyb3B5IGlzIG5vdCBOb25lOgogICAgICAgICAgICBvcHRpb25hbF9lbnRyb3B5ID0gb3B0aW9uYWxfZW50cm9weS5lbmNvZGUoInV0Zi0xNiIpCiAgICAgICAgICAgIHBPcHRpb25hbEVudHJvcHkgPSBEQVRBX0JMT0IobGVuKG9wdGlvbmFsX2VudHJvcHkpLCBjdHlwZXMuY2FzdChvcHRpb25hbF9lbnRyb3B5LCBjdHlwZXMuUE9JTlRFUihjdHlwZXMuY191Ynl0ZSkpKQoKICAgICAgICBpZiBjdHlwZXMud2luZGxsLkNyeXB0MzIuQ3J5cHRVbnByb3RlY3REYXRhKGN0eXBlcy5ieXJlZihwRGF0YUluKSwgTm9uZSwgY3R5cGVzLmJ5cmVmKHBPcHRpb25hbEVudHJvcHkpIGlmIHBPcHRpb25hbEVudHJvcHkgaXMgbm90IE5vbmUgZWxzZSBOb25lLCBOb25lLCBOb25lLCAwLCBjdHlwZXMuYnlyZWYocERhdGFPdXQpKToKICAgICAgICAgICAgZGF0YSA9IChjdHlwZXMuY191Ynl0ZSAqIHBEYXRhT3V0LmNiRGF0YSkoKQogICAgICAgICAgICBjdHlwZXMubWVtbW92ZShkYXRhLCBwRGF0YU91dC5wYkRhdGEsIHBEYXRhT3V0LmNiRGF0YSkKICAgICAgICAgICAgY3R5cGVzLndpbmRsbC5LZXJuZWwzMi5Mb2NhbEZyZWUocERhdGFPdXQucGJEYXRhKQogICAgICAgICAgICByZXR1cm4gYnl0ZXMoZGF0YSkKCiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiSW52YWxpZCBlbmNyeXB0ZWRfZGF0YSBwcm92aWRlZCEiKQogICAgCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgSGlkZUNvbnNvbGUoKSAtPiBOb25lOgogICAgICAgIGN0eXBlcy53aW5kbGwudXNlcjMyLlNob3dXaW5kb3coY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5HZXRDb25zb2xlV2luZG93KCksIDApCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIENyZWF0ZU11dGV4KG11dGV4OiBzdHIpIC0+IGJvb2w6CiAgICAgICAga2VybmVsMzIgPSBjdHlwZXMud2luZGxsLmtlcm5lbDMyCiAgICAgICAgbXV0ZXggPSBrZXJuZWwzMi5DcmVhdGVNdXRleEEoTm9uZSwgRmFsc2UsIG11dGV4LmVuY29kZSgpKQogICAgICAgIHJldHVybiBrZXJuZWwzMi5HZXRMYXN0RXJyb3IoKSAhPSAxODMKCgpjbGFzcyBVdGlsaXR5OgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIEdldFNlbGYoKSAtPiB0dXBsZToKICAgICAgICBpZiBoYXNhdHRyKHN5cywgImZyb3plbiIpOgogICAgICAgICAgICByZXR1cm4gKHN5cy5leGVjdXRhYmxlLCBUcnVlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAoX19maWxlX18sIEZhbHNlKQogICAgCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgR2V0UmFuZG9tU3RyaW5nKGxlbmd0aDogaW50ID0gNSkgLT4gc3RyOgogICAgICAgIHJldHVybiAiIi5qb2luKHJhbmRvbS5jaG9pY2VzKCJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OSIsIGs9bGVuZ3RoKSkKICAgIAogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIElzQ29ubmVjdGVkVG9JbnRlcm5ldCgpIC0+IGJvb2w6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmxvcGVuKCJodHRwczovL3d3dy5nb29nbGUuY29tIiwgdGltZW91dD0zKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBJc0FkbWluKCkgLT4gYm9vbDoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiBjdHlwZXMud2luZGxsLnNoZWxsMzIuSXNVc2VyQW5BZG1pbigpID09IDEKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgR2V0V2lmaVBhc3N3b3JkcygpIC0+IGRpY3Q6CiAgICAgICAgcHJvZmlsZXMgPSBbXQogICAgICAgIHBhc3N3b3JkcyA9IHt9CgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oJ25ldHNoIHdsYW4gc2hvdyBwcm9maWxlJywgc2hlbGw9VHJ1ZSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSkKICAgICAgICAgICAgZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5kZWNvZGUoZXJyb3JzPSdpZ25vcmUnKS5zdHJpcCgpLnNwbGl0bGluZXMoKToKICAgICAgICAgICAgICAgIGlmICdBbGwgVXNlciBQcm9maWxlJyBpbiBsaW5lOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBsaW5lWyhsaW5lLmZpbmQoJzonKSArIDEpOl0uc3RyaXAoKQogICAgICAgICAgICAgICAgICAgIHByb2ZpbGVzLmFwcGVuZChuYW1lKQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIHByb2ZpbGUgaW4gcHJvZmlsZXM6CiAgICAgICAgICAgICAgICBmb3VuZCA9IEZhbHNlCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihmJ25ldHNoIHdsYW4gc2hvdyBwcm9maWxlICJ7cHJvZmlsZX0iIGtleT1jbGVhcicsIHNoZWxsPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUpCiAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiByZXN1bHQuc3Rkb3V0LmRlY29kZShlcnJvcnM9J2lnbm9yZScpLnN0cmlwKCkuc3BsaXRsaW5lcygpOgogICAgICAgICAgICAgICAgICAgIGlmICdLZXkgQ29udGVudCcgaW4gbGluZToKICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmRzW3Byb2ZpbGVdID0gbGluZVsobGluZS5maW5kKCc6JykgKyAxKTpdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBpZiBub3QgZm91bmQ6CiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmRzW3Byb2ZpbGVdID0gJyhOb25lKScKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHRnX2xvZ2dlci5lcnJvcihmIldpZmkgcGFzc3dvcmRzIGVycm9yOiB7ZX0iKQogICAgICAgIAogICAgICAgIHJldHVybiBwYXNzd29yZHMKCgpjbGFzcyBCcm93c2VyczoKICAgIGNsYXNzIENocm9taXVtOgogICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBicm93c2VyUGF0aDogc3RyKToKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguaXNkaXIoYnJvd3NlclBhdGgpOgogICAgICAgICAgICAgICAgcmFpc2UgTm90QURpcmVjdG9yeUVycm9yKCJCcm93c2VyIHBhdGggbm90IGZvdW5kISIpCiAgICAgICAgICAgIHNlbGYuQnJvd3NlclBhdGggPSBicm93c2VyUGF0aAogICAgICAgICAgICBzZWxmLkVuY3J5cHRpb25LZXkgPSBOb25lCiAgICAgICAgCiAgICAgICAgZGVmIEdldEVuY3J5cHRpb25LZXkoc2VsZikgLT4gYnl0ZXM6CiAgICAgICAgICAgIGlmIHNlbGYuRW5jcnlwdGlvbktleSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLkVuY3J5cHRpb25LZXkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsU3RhdGVQYXRoID0gb3MucGF0aC5qb2luKHNlbGYuQnJvd3NlclBhdGgsICJMb2NhbCBTdGF0ZSIpCiAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKGxvY2FsU3RhdGVQYXRoKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4obG9jYWxTdGF0ZVBhdGgsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0iaWdub3JlIikgYXMgZmlsZToKICAgICAgICAgICAgICAgICAgICAgICAganNvbkNvbnRlbnQgPSBqc29uLmxvYWQoZmlsZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbmNyeXB0ZWRLZXkgPSBqc29uQ29udGVudFsib3NfY3J5cHQiXVsiZW5jcnlwdGVkX2tleSJdCiAgICAgICAgICAgICAgICAgICAgZW5jcnlwdGVkS2V5ID0gYmFzZTY0LmI2NGRlY29kZShlbmNyeXB0ZWRLZXkuZW5jb2RlKCkpWzU6XQogICAgICAgICAgICAgICAgICAgIHNlbGYuRW5jcnlwdGlvbktleSA9IFN5c2NhbGxzLkNyeXB0VW5wcm90ZWN0RGF0YShlbmNyeXB0ZWRLZXkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuRW5jcnlwdGlvbktleQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHRnX2xvZ2dlci5lcnJvcihmIkdldEVuY3J5cHRpb25LZXkgZXJyb3I6IHtlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgICAgIGRlZiBEZWNyeXB0KHNlbGYsIGJ1ZmZlcjogYnl0ZXMsIGtleTogYnl0ZXMpIC0+IHN0cjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdmVyc2lvbiA9IGJ1ZmZlci5kZWNvZGUoZXJyb3JzPSJpZ25vcmUiKQogICAgICAgICAgICAgICAgaWYgdmVyc2lvbi5zdGFydHN3aXRoKCgidjEwIiwgInYxMSIpKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBweWFlcwogICAgICAgICAgICAgICAgICAgICAgICBpdiA9IGJ1ZmZlclszOjE1XQogICAgICAgICAgICAgICAgICAgICAgICBjaXBoZXJUZXh0ID0gYnVmZmVyWzE1Ol0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB5YWVzLkFFU01vZGVPZk9wZXJhdGlvbkdDTShrZXksIGl2KS5kZWNyeXB0KGNpcGhlclRleHQpWzotMTZdLmRlY29kZShlcnJvcnM9Imlnbm9yZSIpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHdpdGhvdXQgcHlhZXMKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIoZW5jcnlwdGVkIC0gcHlhZXMgbm90IGluc3RhbGxlZCkiCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHIoU3lzY2FsbHMuQ3J5cHRVbnByb3RlY3REYXRhKGJ1ZmZlcikpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIAogICAgICAgIGRlZiBHZXRQYXNzd29yZHMoc2VsZikgLT4gbGlzdDoKICAgICAgICAgICAgZW5jcnlwdGlvbktleSA9IHNlbGYuR2V0RW5jcnlwdGlvbktleSgpCiAgICAgICAgICAgIHBhc3N3b3JkcyA9IFtdCgogICAgICAgICAgICBpZiBlbmNyeXB0aW9uS2V5IGlzIE5vbmU6CiAgICAgICAgICAgICAgICByZXR1cm4gcGFzc3dvcmRzCgogICAgICAgICAgICBsb2dpbkZpbGVQYXRocyA9IFtdCgogICAgICAgICAgICBmb3Igcm9vdCwgXywgZmlsZXMgaW4gb3Mud2FsayhzZWxmLkJyb3dzZXJQYXRoKToKICAgICAgICAgICAgICAgIGZvciBmaWxlIGluIGZpbGVzOgogICAgICAgICAgICAgICAgICAgIGlmIGZpbGUubG93ZXIoKSA9PSAibG9naW4gZGF0YSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKHJvb3QsIGZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luRmlsZVBhdGhzLmFwcGVuZChmaWxlcGF0aCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBwYXRoIGluIGxvZ2luRmlsZVBhdGhzOgogICAgICAgICAgICAgICAgdGVtcGZpbGUgPSBvcy5wYXRoLmpvaW4ob3MuZ2V0ZW52KCJ0ZW1wIiksIFV0aWxpdHkuR2V0UmFuZG9tU3RyaW5nKDEwKSArICIudG1wIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5KHBhdGgsIHRlbXBmaWxlKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkYiA9IHNxbGl0ZTMuY29ubmVjdCh0ZW1wZmlsZSkKICAgICAgICAgICAgICAgICAgICBkYi50ZXh0X2ZhY3RvcnkgPSBsYW1iZGEgYjogYi5kZWNvZGUoZXJyb3JzPSJpZ25vcmUiKQogICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IGRiLmN1cnNvcigpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5leGVjdXRlKCJTRUxFQ1Qgb3JpZ2luX3VybCwgdXNlcm5hbWVfdmFsdWUsIHBhc3N3b3JkX3ZhbHVlIEZST00gbG9naW5zIikuZmV0Y2hhbGwoKQoKICAgICAgICAgICAgICAgICAgICBmb3IgdXJsLCB1c2VybmFtZSwgcGFzc3dvcmQgaW4gcmVzdWx0czoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQgPSBzZWxmLkRlY3J5cHQocGFzc3dvcmQsIGVuY3J5cHRpb25LZXkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVybCBhbmQgdXNlcm5hbWUgYW5kIHBhc3N3b3JkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmRzLmFwcGVuZCgodXJsLCB1c2VybmFtZSwgcGFzc3dvcmQpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgZGIuY2xvc2UoKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHRnX2xvZ2dlci5lcnJvcihmIkdldFBhc3N3b3JkcyBEQiBlcnJvcjoge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZSh0ZW1wZmlsZSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcGFzc3dvcmRzCiAgICAgICAgCiAgICAgICAgZGVmIEdldENvb2tpZXMoc2VsZikgLT4gbGlzdDoKICAgICAgICAgICAgZW5jcnlwdGlvbktleSA9IHNlbGYuR2V0RW5jcnlwdGlvbktleSgpCiAgICAgICAgICAgIGNvb2tpZXMgPSBbXQoKICAgICAgICAgICAgaWYgZW5jcnlwdGlvbktleSBpcyBOb25lOgogICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZXMKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvb2tpZXNGaWxlUGF0aHMgPSBbXQoKICAgICAgICAgICAgZm9yIHJvb3QsIF8sIGZpbGVzIGluIG9zLndhbGsoc2VsZi5Ccm93c2VyUGF0aCk6CiAgICAgICAgICAgICAgICBmb3IgZmlsZSBpbiBmaWxlczoKICAgICAgICAgICAgICAgICAgICBpZiBmaWxlLmxvd2VyKCkgPT0gImNvb2tpZXMiOgogICAgICAgICAgICAgICAgICAgICAgICBmaWxlcGF0aCA9IG9zLnBhdGguam9pbihyb290LCBmaWxlKQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzRmlsZVBhdGhzLmFwcGVuZChmaWxlcGF0aCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciBwYXRoIGluIGNvb2tpZXNGaWxlUGF0aHM6CiAgICAgICAgICAgICAgICB0ZW1wZmlsZSA9IG9zLnBhdGguam9pbihvcy5nZXRlbnYoInRlbXAiKSwgVXRpbGl0eS5HZXRSYW5kb21TdHJpbmcoMTApICsgIi50bXAiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkocGF0aCwgdGVtcGZpbGUpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRiID0gc3FsaXRlMy5jb25uZWN0KHRlbXBmaWxlKQogICAgICAgICAgICAgICAgICAgIGRiLnRleHRfZmFjdG9yeSA9IGxhbWJkYSBiOiBiLmRlY29kZShlcnJvcnM9Imlnbm9yZSIpCiAgICAgICAgICAgICAgICAgICAgY3Vyc29yID0gZGIuY3Vyc29yKCkKICAgICAgICAgICAgICAgICAgICByZXN1bHRzID0gY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBob3N0X2tleSwgbmFtZSwgcGF0aCwgZW5jcnlwdGVkX3ZhbHVlLCBleHBpcmVzX3V0YyBGUk9NIGNvb2tpZXMiKS5mZXRjaGFsbCgpCgogICAgICAgICAgICAgICAgICAgIGZvciBob3N0LCBuYW1lLCBwYXRoLCBjb29raWUsIGV4cGlyeSBpbiByZXN1bHRzOgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWUgPSBzZWxmLkRlY3J5cHQoY29va2llLCBlbmNyeXB0aW9uS2V5KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBob3N0IGFuZCBuYW1lIGFuZCBjb29raWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzLmFwcGVuZCgoaG9zdCwgbmFtZSwgcGF0aCwgY29va2llLCBleHBpcnkpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgZGIuY2xvc2UoKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHRnX2xvZ2dlci5lcnJvcihmIkdldENvb2tpZXMgREIgZXJyb3I6IHtlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUodGVtcGZpbGUpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGNvb2tpZXMKCgpjbGFzcyBUZWxlZ3JhbVN0ZWFsZXI6CiAgICAiIiLQmtGA0LDQtNGR0YIgVGVsZWdyYW0gdGRhdGEsINCw0YDRhdC40LLQuNGA0YPQtdGCINC4INC+0YLQv9GA0LDQstC70Y/QtdGCINGB0YDQsNC30YMgKyDRgdC10YHRgdC40LgiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNhdmVfZGlyOiBzdHIpOgogICAgICAgIHNlbGYuc2F2ZV9kaXIgPSBzYXZlX2RpcgogICAgICAgIHNlbGYudGRhdGFfZGlyID0gb3MucGF0aC5qb2luKHNhdmVfZGlyLCAiVGVsZWdyYW1fdGRhdGEiKQogICAgICAgIHNlbGYuc2Vzc2lvbnNfZGlyID0gb3MucGF0aC5qb2luKHNhdmVfZGlyLCAiVGVsZWdyYW1fU2Vzc2lvbnMiKQogICAgICAgIG9zLm1ha2VkaXJzKHNlbGYudGRhdGFfZGlyLCBleGlzdF9vaz1UcnVlKQogICAgICAgIG9zLm1ha2VkaXJzKHNlbGYuc2Vzc2lvbnNfZGlyLCBleGlzdF9vaz1UcnVlKQogICAgICAgIHNlbGYuZm91bmRfc2Vzc2lvbnMgPSAwCiAgICAKICAgIGRlZiBnZXRfYWxsX2RyaXZlcyhzZWxmKSAtPiBsaXN0OgogICAgICAgICIiItCf0L7Qu9GD0YfQsNC10YIg0YHQv9C40YHQvtC6INCy0YHQtdGFINC00LjRgdC60L7QsiIiIgogICAgICAgIGRyaXZlcyA9IFtdCiAgICAgICAgZm9yIGxldHRlciBpbiAnQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaQUInOgogICAgICAgICAgICBkcml2ZSA9IGYie2xldHRlcn06XFwiCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGRyaXZlKToKICAgICAgICAgICAgICAgIGRyaXZlcy5hcHBlbmQoZHJpdmUpCiAgICAgICAgcmV0dXJuIGRyaXZlcwogICAgCiAgICBkZWYgZmluZF90ZGF0YV9wYXRocyhzZWxmKSAtPiBsaXN0OgogICAgICAgICIiItCY0YnQtdGCINCy0YHQtSB0ZGF0YSDQv9Cw0L/QutC4INC90LAg0LLRgdC10YUg0LTQuNGB0LrQsNGFIiIiCiAgICAgICAgdGRhdGFfcGF0aHMgPSBbXQogICAgICAgIAogICAgICAgIHRnX2xvZ2dlci5pbmZvKCJTZWFyY2hpbmcgZm9yIFRlbGVncmFtIHRkYXRhIG9uIGFsbCBkcml2ZXMuLi4iKQogICAgICAgIAogICAgICAgICMg0KHRgtCw0L3QtNCw0YDRgtC90YvQtSDQv9GD0YLQuAogICAgICAgIGFwcGRhdGEgPSBvcy5nZXRlbnYoImFwcGRhdGEiLCAiIikKICAgICAgICBsb2NhbGFwcGRhdGEgPSBvcy5nZXRlbnYoImxvY2FsYXBwZGF0YSIsICIiKQogICAgICAgIAogICAgICAgIHN0YW5kYXJkX3BhdGhzID0gWwogICAgICAgICAgICBvcy5wYXRoLmpvaW4oYXBwZGF0YSwgIlRlbGVncmFtIERlc2t0b3AiLCAidGRhdGEiKSwKICAgICAgICAgICAgb3MucGF0aC5qb2luKGxvY2FsYXBwZGF0YSwgIlRlbGVncmFtIERlc2t0b3AiLCAidGRhdGEiKSwKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdGggaW4gc3RhbmRhcmRfcGF0aHM6CiAgICAgICAgICAgIGlmIG9zLnBhdGguaXNkaXIocGF0aCk6CiAgICAgICAgICAgICAgICB0ZGF0YV9wYXRocy5hcHBlbmQocGF0aCkKICAgICAgICAgICAgICAgIHRnX2xvZ2dlci5pbmZvKGYiRm91bmQgdGRhdGE6IHtwYXRofSIpCiAgICAgICAgCiAgICAgICAgIyDQn9C+0LjRgdC6INC/0L4g0LLRgdC10Lwg0LTQuNGB0LrQsNC8INC4INC/0YDQvtGE0LjQu9GP0Lwg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C10LkKICAgICAgICBmb3IgZHJpdmUgaW4gc2VsZi5nZXRfYWxsX2RyaXZlcygpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1c2Vyc19wYXRoID0gb3MucGF0aC5qb2luKGRyaXZlLCAiVXNlcnMiKQogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2Rpcih1c2Vyc19wYXRoKToKICAgICAgICAgICAgICAgICAgICBmb3IgdXNlciBpbiBvcy5saXN0ZGlyKHVzZXJzX3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiB1c2VyLnN0YXJ0c3dpdGgoJy4nKSBvciB1c2VyIGluIFsnUHVibGljJywgJ0RlZmF1bHQnLCAnRGVmYXVsdCBVc2VyJywgJ0FsbCBVc2VycyddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlX3BhdGhzID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucGF0aC5qb2luKHVzZXJzX3BhdGgsIHVzZXIsICJBcHBEYXRhIiwgIlJvYW1pbmciLCAiVGVsZWdyYW0gRGVza3RvcCIsICJ0ZGF0YSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucGF0aC5qb2luKHVzZXJzX3BhdGgsIHVzZXIsICJBcHBEYXRhIiwgIkxvY2FsIiwgIlRlbGVncmFtIERlc2t0b3AiLCAidGRhdGEiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbih1c2Vyc19wYXRoLCB1c2VyLCAiRGVza3RvcCIsICJUZWxlZ3JhbSBEZXNrdG9wIiwgInRkYXRhIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5wYXRoLmpvaW4odXNlcnNfcGF0aCwgdXNlciwgIkRvY3VtZW50cyIsICJUZWxlZ3JhbSBEZXNrdG9wIiwgInRkYXRhIiksCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwYXRoIGluIHBvc3NpYmxlX3BhdGhzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2RpcihwYXRoKSBhbmQgcGF0aCBub3QgaW4gdGRhdGFfcGF0aHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGRhdGFfcGF0aHMuYXBwZW5kKHBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oZiJGb3VuZCB0ZGF0YToge3BhdGh9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcm9vdF9wYXRocyA9IFsKICAgICAgICAgICAgICAgICAgICBvcy5wYXRoLmpvaW4oZHJpdmUsICJUZWxlZ3JhbSBEZXNrdG9wIiwgInRkYXRhIiksCiAgICAgICAgICAgICAgICAgICAgb3MucGF0aC5qb2luKGRyaXZlLCAiVGVsZWdyYW0iLCAidGRhdGEiKSwKICAgICAgICAgICAgICAgICAgICBvcy5wYXRoLmpvaW4oZHJpdmUsICJQcm9ncmFtIEZpbGVzIiwgIlRlbGVncmFtIERlc2t0b3AiLCAidGRhdGEiKSwKICAgICAgICAgICAgICAgICAgICBvcy5wYXRoLmpvaW4oZHJpdmUsICJQcm9ncmFtIEZpbGVzICh4ODYpIiwgIlRlbGVncmFtIERlc2t0b3AiLCAidGRhdGEiKSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIHBhdGggaW4gcm9vdF9wYXRoczoKICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHBhdGgpIGFuZCBwYXRoIG5vdCBpbiB0ZGF0YV9wYXRoczoKICAgICAgICAgICAgICAgICAgICAgICAgdGRhdGFfcGF0aHMuYXBwZW5kKHBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRnX2xvZ2dlci5pbmZvKGYiRm91bmQgdGRhdGE6IHtwYXRofSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICByZXR1cm4gdGRhdGFfcGF0aHMKICAgIAogICAgZGVmIHppcF9hbmRfc2VuZF90ZGF0YShzZWxmLCB0ZGF0YV9wYXRoOiBzdHIpIC0+IGJvb2w6CiAgICAgICAgIiIi0JDRgNGF0LjQstC40YDRg9C10YIgdGRhdGEg0Lgg0YHRgNCw0LfRgyDQvtGC0L/RgNCw0LLQu9GP0LXRgiDQsiBUZWxlZ3JhbSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IHppcGZpbGUKICAgICAgICAgICAgCiAgICAgICAgICAgICMg0KDQsNC90LTQvtC80L3QvtC1INC40LzRjyAxNiDRgdC40LzQstC+0LvQvtCyCiAgICAgICAgICAgIHJhbmRvbV9uYW1lID0gJycuam9pbihyYW5kb20uY2hvaWNlcygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Jywgaz0xNikpCiAgICAgICAgICAgIHppcF9wYXRoID0gb3MucGF0aC5qb2luKG9zLmdldGVudigidGVtcCIpLCBmInRkYXRhX3tyYW5kb21fbmFtZX0uemlwIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHRnX2xvZ2dlci5pbmZvKGYiWmlwcGluZyB0ZGF0YS4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoIHppcGZpbGUuWmlwRmlsZSh6aXBfcGF0aCwgJ3cnLCB6aXBmaWxlLlpJUF9ERUZMQVRFRCkgYXMgemlwZjoKICAgICAgICAgICAgICAgIGZvciBpdGVtIGluIG9zLmxpc3RkaXIodGRhdGFfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgaWYgaXRlbS5zdGFydHN3aXRoKCcuJykgb3IgaXRlbS5zdGFydHN3aXRoKCdfJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc3JjID0gb3MucGF0aC5qb2luKHRkYXRhX3BhdGgsIGl0ZW0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZmlsZShzcmMpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5nZXRzaXplKHNyYykgPCA1MCAqIDEwMjQgKiAxMDI0OiAgIyA8IDUwTUIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6aXBmLndyaXRlKHNyYywgaXRlbSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBvcy5wYXRoLmlzZGlyKHNyYyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3Igcm9vdCwgZGlycywgZmlsZXMgaW4gb3Mud2FsayhzcmMpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBmaWxlIGluIGZpbGVzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4ocm9vdCwgZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJjbmFtZSA9IG9zLnBhdGgucmVscGF0aChmaWxlX3BhdGgsIHRkYXRhX3BhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZ2V0c2l6ZShmaWxlX3BhdGgpIDwgMTAgKiAxMDI0ICogMTAyNDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHppcGYud3JpdGUoZmlsZV9wYXRoLCBhcmNuYW1lKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUoemlwX3BhdGgpIGFuZCBvcy5wYXRoLmdldHNpemUoemlwX3BhdGgpID4gMDoKICAgICAgICAgICAgICAgIGNhcHRpb24gPSBmIvCfk7EgVGVsZWdyYW0gVERhdGFcbvCfk4Ige29zLnBhdGguYmFzZW5hbWUodGRhdGFfcGF0aCl9IgogICAgICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oZiJTZW5kaW5nIHRkYXRhIHRvIFRlbGVncmFtLi4uIikKICAgICAgICAgICAgICAgIHRnX2xvZ2dlci5zZW5kX2ZpbGUoemlwX3BhdGgsIGNhcHRpb24pCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoemlwX3BhdGgpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgdGdfbG9nZ2VyLmVycm9yKGYiRXJyb3IgemlwcGluZyB0ZGF0YToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBjb252ZXJ0X2FuZF9zZW5kX3Nlc3Npb25zKHNlbGYsIHRkYXRhX3BhdGg6IHN0cikgLT4gaW50OgogICAgICAgICIiItCa0L7QvdCy0LXRgNGC0LjRgNGD0LXRgiB0ZGF0YSDQsiBzZXNzaW9ucyDQuCDQvtGC0L/RgNCw0LLQu9GP0LXRgiDQvtC00L3QuNC8INCw0YDRhdC40LLQvtC8IiIiCiAgICAgICAgc2Vzc2lvbnNfY3JlYXRlZCA9IDAKICAgICAgICB0ZW1wX3Nlc3Npb25zID0gb3MucGF0aC5qb2luKG9zLmdldGVudigidGVtcCIpLCAidGdfc2Vzc2lvbnNfdGVtcCIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmcm9tIG9wZW50ZWxlLnRkIGltcG9ydCBURGVza3RvcAogICAgICAgICAgICBmcm9tIG9wZW50ZWxlLmFwaSBpbXBvcnQgVXNlQ3VycmVudFNlc3Npb24KICAgICAgICAgICAgaW1wb3J0IGFzeW5jaW8KICAgICAgICAgICAgaW1wb3J0IHppcGZpbGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHRlbXBfc2Vzc2lvbnMpOgogICAgICAgICAgICAgICAgc2h1dGlsLnJtdHJlZSh0ZW1wX3Nlc3Npb25zKQogICAgICAgICAgICBvcy5tYWtlZGlycyh0ZW1wX3Nlc3Npb25zLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgdGRlc2sgPSBURGVza3RvcCh0ZGF0YV9wYXRoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHRkZXNrLmlzTG9hZGVkKCk6CiAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAKICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oZiJDb252ZXJ0aW5nIHtsZW4odGRlc2suYWNjb3VudHMpfSBhY2NvdW50KHMpIHRvIHNlc3Npb25zLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGFzeW5jIGRlZiBjb252ZXJ0KCk6CiAgICAgICAgICAgICAgICBub25sb2NhbCBzZXNzaW9uc19jcmVhdGVkCiAgICAgICAgICAgICAgICBmb3IgaSwgYWNjb3VudCBpbiBlbnVtZXJhdGUodGRlc2suYWNjb3VudHMpOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9wYXRoID0gb3MucGF0aC5qb2luKHRlbXBfc2Vzc2lvbnMsIGYic2Vzc2lvbl97aSsxfS5zZXNzaW9uIikKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYWNjb3VudC5Ub1RlbGV0aG9uKHNlc3Npb249c2Vzc2lvbl9wYXRoLCBmbGFnPVVzZUN1cnJlbnRTZXNzaW9uKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZmlsZShzZXNzaW9uX3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbnNfY3JlYXRlZCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0Z19sb2dnZXIuaW5mbyhmIuKchSBTZXNzaW9uICN7aSsxfSIpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICBsb29wID0gYXN5bmNpby5uZXdfZXZlbnRfbG9vcCgpCiAgICAgICAgICAgIGFzeW5jaW8uc2V0X2V2ZW50X2xvb3AobG9vcCkKICAgICAgICAgICAgbG9vcC5ydW5fdW50aWxfY29tcGxldGUoY29udmVydCgpKQogICAgICAgICAgICBsb29wLmNsb3NlKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg0J7RgtC/0YDQsNCy0LvRj9C10Lwg0LLRgdC1INGB0LXRgdGB0LjQuCDQvtC00L3QuNC8INCw0YDRhdC40LLQvtC8CiAgICAgICAgICAgIGlmIHNlc3Npb25zX2NyZWF0ZWQgPiAwOgogICAgICAgICAgICAgICAgcmFuZG9tX25hbWUgPSAnJy5qb2luKHJhbmRvbS5jaG9pY2VzKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknLCBrPTE2KSkKICAgICAgICAgICAgICAgIHNlc3Npb25zX3ppcCA9IG9zLnBhdGguam9pbihvcy5nZXRlbnYoInRlbXAiKSwgZiJzZXNzaW9uc197cmFuZG9tX25hbWV9LnppcCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKHNlc3Npb25zX3ppcCwgJ3cnKSBhcyB6aXBmOgogICAgICAgICAgICAgICAgICAgIGZvciBmIGluIG9zLmxpc3RkaXIodGVtcF9zZXNzaW9ucyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGYuZW5kc3dpdGgoJy5zZXNzaW9uJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6aXBmLndyaXRlKG9zLnBhdGguam9pbih0ZW1wX3Nlc3Npb25zLCBmKSwgZikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGdfbG9nZ2VyLnNlbmRfZmlsZShzZXNzaW9uc196aXAsIGYi8J+UkCBUZWxlZ3JhbSBTZXNzaW9ucyAoe3Nlc3Npb25zX2NyZWF0ZWR9IGFjY291bnRzKSIpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc2Vzc2lvbnNfemlwKQogICAgICAgICAgICAKICAgICAgICAgICAgc2h1dGlsLnJtdHJlZSh0ZW1wX3Nlc3Npb25zLCBpZ25vcmVfZXJyb3JzPVRydWUpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgIHJldHVybiBzZXNzaW9uc19jcmVhdGVkCiAgICAKICAgIGRlZiBzdGVhbF9hbGxfc2Vzc2lvbnMoc2VsZikgLT4gaW50OgogICAgICAgICIiItCY0YnQtdGCIHRkYXRhLCDQt9C40L/Rg9C10YIg0Lgg0L7RgtC/0YDQsNCy0LvRj9C10YIgKyDRgdC10YHRgdC40LgiIiIKICAgICAgICB0Z19sb2dnZXIuaW5mbygiU3RhcnRpbmcgVGVsZWdyYW0gc3RlYWxpbmcuLi4iKQogICAgICAgIAogICAgICAgIHRkYXRhX3BhdGhzID0gc2VsZi5maW5kX3RkYXRhX3BhdGhzKCkKICAgICAgICAKICAgICAgICBpZiBub3QgdGRhdGFfcGF0aHM6CiAgICAgICAgICAgIHRnX2xvZ2dlci5pbmZvKCJObyBUZWxlZ3JhbSB0ZGF0YSBmb3VuZCIpCiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgCiAgICAgICAgdGdfbG9nZ2VyLmluZm8oZiJGb3VuZCB7bGVuKHRkYXRhX3BhdGhzKX0gdGRhdGEgZm9sZGVyKHMpIikKICAgICAgICAKICAgICAgICBmb3IgcGF0aCBpbiB0ZGF0YV9wYXRoczoKICAgICAgICAgICAgIyDQntGC0L/RgNCw0LLQu9GP0LXQvCB0ZGF0YQogICAgICAgICAgICBpZiBzZWxmLnppcF9hbmRfc2VuZF90ZGF0YShwYXRoKToKICAgICAgICAgICAgICAgIHNlbGYuZm91bmRfc2Vzc2lvbnMgKz0gMQogICAgICAgICAgICAKICAgICAgICAgICAgIyDQn9GA0L7QsdGD0LXQvCDRgdC10YHRgdC40LgKICAgICAgICAgICAgc2VsZi5jb252ZXJ0X2FuZF9zZW5kX3Nlc3Npb25zKHBhdGgpCiAgICAgICAgCiAgICAgICAgdGdfbG9nZ2VyLmluZm8oZiJUb3RhbCB0ZGF0YSBzZW50OiB7c2VsZi5mb3VuZF9zZXNzaW9uc30iKQogICAgICAgIHJldHVybiBzZWxmLmZvdW5kX3Nlc3Npb25zCgoKCmNsYXNzIFN0YXJTdGVhbGVyOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuVGVtcEZvbGRlciA9IG9zLnBhdGguam9pbihvcy5nZXRlbnYoInRlbXAiKSwgIlN0YXJTdGVhbGVyXyIgKyBVdGlsaXR5LkdldFJhbmRvbVN0cmluZyg4KSkKICAgICAgICBvcy5tYWtlZGlycyhzZWxmLlRlbXBGb2xkZXIsIGV4aXN0X29rPVRydWUpCiAgICAgICAgCiAgICAgICAgc2VsZi5QYXNzd29yZHNDb3VudCA9IDAKICAgICAgICBzZWxmLkNvb2tpZXNDb3VudCA9IDAKICAgICAgICBzZWxmLldpZmlQYXNzd29yZHNDb3VudCA9IDAKICAgICAgICBzZWxmLlRlbGVncmFtU2Vzc2lvbnNDb3VudCA9IDAKICAgICAgICBzZWxmLlN5c3RlbUluZm9TdG9sZW4gPSBGYWxzZQogICAgICAgIHNlbGYuU2NyZWVuc2hvdFRha2VuID0gRmFsc2UKICAgICAgICAKICAgICAgICB0Z19sb2dnZXIuaW5mbygiU3RhciBTdGVhbGVyIGluaXRpYWxpemVkIikKICAgICAgICB0Z19sb2dnZXIuc2VuZF9zdGFydHVwX25vdGlmaWNhdGlvbigpCiAgICAgICAgCiAgICAgICAgc2VsZi5SdW4oKQogICAgCiAgICBkZWYgUnVuKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oIlN0YXJ0aW5nIGRhdGEgY29sbGVjdGlvbi4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINCX0LDQutGA0YvQstCw0LXQvCDQsdGA0LDRg9C30LXRgNGLINC00LvRjyDQtNC+0YHRgtGD0L/QsCDQuiDQsdCw0LfQsNC8INC00LDQvdC90YvRhQogICAgICAgICAgICBzZWxmLktpbGxCcm93c2VycygpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINCh0L7QsdC40YDQsNC10Lwg0LTQsNC90L3Ri9C1CiAgICAgICAgICAgIGlmIFNldHRpbmdzLkNhcHR1cmVQYXNzd29yZHM6CiAgICAgICAgICAgICAgICBzZWxmLlN0ZWFsUGFzc3dvcmRzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIFNldHRpbmdzLkNhcHR1cmVDb29raWVzOgogICAgICAgICAgICAgICAgc2VsZi5TdGVhbENvb2tpZXMoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgU2V0dGluZ3MuQ2FwdHVyZVdpZmlQYXNzd29yZHM6CiAgICAgICAgICAgICAgICBzZWxmLlN0ZWFsV2lmaVBhc3N3b3JkcygpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBTZXR0aW5ncy5DYXB0dXJlVGVsZWdyYW06CiAgICAgICAgICAgICAgICBzZWxmLlN0ZWFsVGVsZWdyYW0oKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgU2V0dGluZ3MuQ2FwdHVyZVN5c3RlbUluZm86CiAgICAgICAgICAgICAgICBzZWxmLlN0ZWFsU3lzdGVtSW5mbygpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBTZXR0aW5ncy5DYXB0dXJlU2NyZWVuc2hvdDoKICAgICAgICAgICAgICAgIHNlbGYuVGFrZVNjcmVlbnNob3QoKQogICAgICAgICAgICAKICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oIkRhdGEgY29sbGVjdGlvbiBjb21wbGV0ZWQiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDQodC+0LfQtNCw0ZHQvCDQsNGA0YXQuNCyINC4INC+0YLQv9GA0LDQstC70Y/QtdC8CiAgICAgICAgICAgIHNlbGYuU2VuZERhdGEoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDQntGC0L/RgNCw0LLQu9GP0LXQvCDRhNC40L3QsNC70YzQvdGL0LUg0LvQvtCz0LgKICAgICAgICAgICAgc3RhdHMgPSB7CiAgICAgICAgICAgICAgICAiUGFzc3dvcmRzIjogc2VsZi5QYXNzd29yZHNDb3VudCwKICAgICAgICAgICAgICAgICJDb29raWVzIjogc2VsZi5Db29raWVzQ291bnQsCiAgICAgICAgICAgICAgICAiV2lGaSBQYXNzd29yZHMiOiBzZWxmLldpZmlQYXNzd29yZHNDb3VudCwKICAgICAgICAgICAgICAgICJUZWxlZ3JhbSBTZXNzaW9ucyI6IHNlbGYuVGVsZWdyYW1TZXNzaW9uc0NvdW50LAogICAgICAgICAgICAgICAgIlN5c3RlbSBJbmZvIjogIlllcyIgaWYgc2VsZi5TeXN0ZW1JbmZvU3RvbGVuIGVsc2UgIk5vIiwKICAgICAgICAgICAgICAgICJTY3JlZW5zaG90IjogIlllcyIgaWYgc2VsZi5TY3JlZW5zaG90VGFrZW4gZWxzZSAiTm8iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRnX2xvZ2dlci5zZW5kX2xvZ3MoKQogICAgICAgICAgICB0Z19sb2dnZXIuc2VuZF9jb21wbGV0aW9uX25vdGlmaWNhdGlvbihzdGF0cykKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBlcnJvcl9tc2cgPSB0cmFjZWJhY2suZm9ybWF0X2V4YygpCiAgICAgICAgICAgIHRnX2xvZ2dlci5lcnJvcihmIkZhdGFsIGVycm9yOiB7ZXJyb3JfbXNnfSIpCiAgICAgICAgICAgIHRnX2xvZ2dlci5zZW5kX2Vycm9yX25vdGlmaWNhdGlvbihlcnJvcl9tc2cpCiAgICAgICAgZmluYWxseToKICAgICAgICAgICAgc2VsZi5DbGVhbnVwKCkKICAgIAogICAgZGVmIEtpbGxCcm93c2VycyhzZWxmKToKICAgICAgICAiIiLQl9Cw0LrRgNGL0LLQsNC10YIg0LHRgNCw0YPQt9C10YDRiyDQtNC70Y8g0LTQvtGB0YLRg9C/0LAg0Log0LHQsNC30LDQvCDQv9Cw0YDQvtC70LXQuSIiIgogICAgICAgIHRnX2xvZ2dlci5pbmZvKCJDbG9zaW5nIGJyb3dzZXJzLi4uIikKICAgICAgICAKICAgICAgICBicm93c2VycyA9IFsKICAgICAgICAgICAgImNocm9tZS5leGUiLCAibXNlZGdlLmV4ZSIsICJicmF2ZS5leGUiLCAKICAgICAgICAgICAgIm9wZXJhLmV4ZSIsICJmaXJlZm94LmV4ZSIsICJicm93c2VyLmV4ZSIsCiAgICAgICAgICAgICJjaHJvbWl1bS5leGUiLCAidml2YWxkaS5leGUiLCAieWFuZGV4LmV4ZSIKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIGJyb3dzZXIgaW4gYnJvd3NlcnM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKGYidGFza2tpbGwgL2YgL2ltIHticm93c2VyfSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoZWxsPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICB0aW1lLnNsZWVwKDEpICAjINCW0LTRkdC8INC30LDQutGA0YvRgtC40Y8KICAgICAgICB0Z19sb2dnZXIuaW5mbygiQnJvd3NlcnMgY2xvc2VkIikKICAgIAogICAgZGVmIFN0ZWFsUGFzc3dvcmRzKHNlbGYpOgogICAgICAgIHRnX2xvZ2dlci5pbmZvKCJTdGVhbGluZyBwYXNzd29yZHMuLi4iKQogICAgICAgIAogICAgICAgIGJyb3dzZXJzID0gewogICAgICAgICAgICAiQ2hyb21lIjogb3MucGF0aC5qb2luKG9zLmdldGVudigibG9jYWxhcHBkYXRhIiksICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIpLAogICAgICAgICAgICAiRWRnZSI6IG9zLnBhdGguam9pbihvcy5nZXRlbnYoImxvY2FsYXBwZGF0YSIpLCAiTWljcm9zb2Z0IiwgIkVkZ2UiLCAiVXNlciBEYXRhIiksCiAgICAgICAgICAgICJCcmF2ZSI6IG9zLnBhdGguam9pbihvcy5nZXRlbnYoImxvY2FsYXBwZGF0YSIpLCAiQnJhdmVTb2Z0d2FyZSIsICJCcmF2ZS1Ccm93c2VyIiwgIlVzZXIgRGF0YSIpLAogICAgICAgICAgICAiT3BlcmEiOiBvcy5wYXRoLmpvaW4ob3MuZ2V0ZW52KCJhcHBkYXRhIiksICJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBTdGFibGUiKSwKICAgICAgICAgICAgIk9wZXJhIEdYIjogb3MucGF0aC5qb2luKG9zLmdldGVudigiYXBwZGF0YSIpLCAiT3BlcmEgU29mdHdhcmUiLCAiT3BlcmEgR1ggU3RhYmxlIiksCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGFsbF9wYXNzd29yZHMgPSBbXQogICAgICAgIAogICAgICAgIGZvciBuYW1lLCBwYXRoIGluIGJyb3dzZXJzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIG9zLnBhdGguaXNkaXIocGF0aCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9IEJyb3dzZXJzLkNocm9taXVtKHBhdGgpCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmRzID0gYnJvd3Nlci5HZXRQYXNzd29yZHMoKQogICAgICAgICAgICAgICAgICAgIGFsbF9wYXNzd29yZHMuZXh0ZW5kKHBhc3N3b3JkcykKICAgICAgICAgICAgICAgICAgICB0Z19sb2dnZXIuaW5mbyhmIntuYW1lfToge2xlbihwYXNzd29yZHMpfSBwYXNzd29yZHMgZm91bmQiKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHRnX2xvZ2dlci53YXJuaW5nKGYie25hbWV9IGVycm9yOiB7ZX0iKQogICAgICAgIAogICAgICAgIGlmIGFsbF9wYXNzd29yZHM6CiAgICAgICAgICAgIHBhc3N3b3Jkc19maWxlID0gb3MucGF0aC5qb2luKHNlbGYuVGVtcEZvbGRlciwgInBhc3N3b3Jkcy50eHQiKQogICAgICAgICAgICB3aXRoIG9wZW4ocGFzc3dvcmRzX2ZpbGUsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgIGZvciB1cmwsIHVzZXJuYW1lLCBwYXNzd29yZCBpbiBhbGxfcGFzc3dvcmRzOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJVUkw6IHt1cmx9XG5Vc2VybmFtZToge3VzZXJuYW1lfVxuUGFzc3dvcmQ6IHtwYXNzd29yZH1cbnsnPScqNTB9XG4iKQogICAgICAgICAgICBzZWxmLlBhc3N3b3Jkc0NvdW50ID0gbGVuKGFsbF9wYXNzd29yZHMpCiAgICAgICAgICAgIHRnX2xvZ2dlci5pbmZvKGYiVG90YWwgcGFzc3dvcmRzIGNvbGxlY3RlZDoge3NlbGYuUGFzc3dvcmRzQ291bnR9IikKICAgIAogICAgZGVmIFN0ZWFsQ29va2llcyhzZWxmKToKICAgICAgICB0Z19sb2dnZXIuaW5mbygiU3RlYWxpbmcgY29va2llcy4uLiIpCiAgICAgICAgCiAgICAgICAgYnJvd3NlcnMgPSB7CiAgICAgICAgICAgICJDaHJvbWUiOiBvcy5wYXRoLmpvaW4ob3MuZ2V0ZW52KCJsb2NhbGFwcGRhdGEiKSwgIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIiksCiAgICAgICAgICAgICJFZGdlIjogb3MucGF0aC5qb2luKG9zLmdldGVudigibG9jYWxhcHBkYXRhIiksICJNaWNyb3NvZnQiLCAiRWRnZSIsICJVc2VyIERhdGEiKSwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYWxsX2Nvb2tpZXMgPSBbXQogICAgICAgIAogICAgICAgIGZvciBuYW1lLCBwYXRoIGluIGJyb3dzZXJzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIG9zLnBhdGguaXNkaXIocGF0aCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9IEJyb3dzZXJzLkNocm9taXVtKHBhdGgpCiAgICAgICAgICAgICAgICAgICAgY29va2llcyA9IGJyb3dzZXIuR2V0Q29va2llcygpCiAgICAgICAgICAgICAgICAgICAgYWxsX2Nvb2tpZXMuZXh0ZW5kKGNvb2tpZXMpCiAgICAgICAgICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oZiJ7bmFtZX06IHtsZW4oY29va2llcyl9IGNvb2tpZXMgZm91bmQiKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHRnX2xvZ2dlci53YXJuaW5nKGYie25hbWV9IGNvb2tpZXMgZXJyb3I6IHtlfSIpCiAgICAgICAgCiAgICAgICAgaWYgYWxsX2Nvb2tpZXM6CiAgICAgICAgICAgIGNvb2tpZXNfZmlsZSA9IG9zLnBhdGguam9pbihzZWxmLlRlbXBGb2xkZXIsICJjb29raWVzLnR4dCIpCiAgICAgICAgICAgIHdpdGggb3Blbihjb29raWVzX2ZpbGUsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgIGZvciBob3N0LCBuYW1lLCBwYXRoLCB2YWx1ZSwgZXhwaXJ5IGluIGFsbF9jb29raWVzOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7aG9zdH1cdFRSVUVcdHtwYXRofVx0RkFMU0VcdHtleHBpcnl9XHR7bmFtZX1cdHt2YWx1ZX1cbiIpCiAgICAgICAgICAgIHNlbGYuQ29va2llc0NvdW50ID0gbGVuKGFsbF9jb29raWVzKQogICAgICAgICAgICB0Z19sb2dnZXIuaW5mbyhmIlRvdGFsIGNvb2tpZXMgY29sbGVjdGVkOiB7c2VsZi5Db29raWVzQ291bnR9IikKICAgIAogICAgZGVmIFN0ZWFsV2lmaVBhc3N3b3JkcyhzZWxmKToKICAgICAgICB0Z19sb2dnZXIuaW5mbygiU3RlYWxpbmcgV2lGaSBwYXNzd29yZHMuLi4iKQogICAgICAgIAogICAgICAgIHBhc3N3b3JkcyA9IFV0aWxpdHkuR2V0V2lmaVBhc3N3b3JkcygpCiAgICAgICAgCiAgICAgICAgaWYgcGFzc3dvcmRzOgogICAgICAgICAgICB3aWZpX2ZpbGUgPSBvcy5wYXRoLmpvaW4oc2VsZi5UZW1wRm9sZGVyLCAid2lmaV9wYXNzd29yZHMudHh0IikKICAgICAgICAgICAgd2l0aCBvcGVuKHdpZmlfZmlsZSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgZm9yIG5ldHdvcmssIHBhc3N3b3JkIGluIHBhc3N3b3Jkcy5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJOZXR3b3JrOiB7bmV0d29ya31cblBhc3N3b3JkOiB7cGFzc3dvcmR9XG57Jz0nKjMwfVxuIikKICAgICAgICAgICAgc2VsZi5XaWZpUGFzc3dvcmRzQ291bnQgPSBsZW4ocGFzc3dvcmRzKQogICAgICAgICAgICB0Z19sb2dnZXIuaW5mbyhmIldpRmkgcGFzc3dvcmRzIGNvbGxlY3RlZDoge3NlbGYuV2lmaVBhc3N3b3Jkc0NvdW50fSIpCiAgICAKICAgIGRlZiBTdGVhbFRlbGVncmFtKHNlbGYpOgogICAgICAgICIiItCY0YnQtdGCINC4INC60L7Qv9C40YDRg9C10YIg0LLRgdC1IFRlbGVncmFtIHRkYXRhINC/0LDQv9C60Lgg0YHQviDQstGB0LXRhSDQtNC40YHQutC+0LIiIiIKICAgICAgICB0Z19sb2dnZXIuaW5mbygiU3RlYWxpbmcgVGVsZWdyYW0gc2Vzc2lvbnMuLi4iKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgdGVsZWdyYW1fc3RlYWxlciA9IFRlbGVncmFtU3RlYWxlcihzZWxmLlRlbXBGb2xkZXIpCiAgICAgICAgICAgIHNlbGYuVGVsZWdyYW1TZXNzaW9uc0NvdW50ID0gdGVsZWdyYW1fc3RlYWxlci5zdGVhbF9hbGxfc2Vzc2lvbnMoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc2VsZi5UZWxlZ3JhbVNlc3Npb25zQ291bnQgPiAwOgogICAgICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oZiJUZWxlZ3JhbSBzZXNzaW9ucyBzdG9sZW46IHtzZWxmLlRlbGVncmFtU2Vzc2lvbnNDb3VudH0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oIk5vIFRlbGVncmFtIHNlc3Npb25zIGZvdW5kIikKICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgdGdfbG9nZ2VyLmVycm9yKGYiVGVsZWdyYW0gc3RlYWxpbmcgZXJyb3I6IHtlfSIpCiAgICAKICAgIGRlZiBTdGVhbFN5c3RlbUluZm8oc2VsZik6CiAgICAgICAgdGdfbG9nZ2VyLmluZm8oIkNvbGxlY3Rpbmcgc3lzdGVtIGluZm8uLi4iKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgaW5mbyA9IFtdCiAgICAgICAgICAgIGluZm8uYXBwZW5kKGYiQ29tcHV0ZXIgTmFtZToge29zLmdldGVudignY29tcHV0ZXJuYW1lJywgJ1Vua25vd24nKX0iKQogICAgICAgICAgICBpbmZvLmFwcGVuZChmIlVzZXJuYW1lOiB7b3MuZ2V0bG9naW4oKX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBPUwogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bignd21pYyBvcyBnZXQgQ2FwdGlvbicsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHNoZWxsPVRydWUpCiAgICAgICAgICAgIG9zX2luZm8gPSByZXN1bHQuc3Rkb3V0LmRlY29kZShlcnJvcnM9J2lnbm9yZScpLnN0cmlwKCkuc3BsaXRsaW5lcygpCiAgICAgICAgICAgIGluZm8uYXBwZW5kKGYiT1M6IHtvc19pbmZvWzJdLnN0cmlwKCkgaWYgbGVuKG9zX2luZm8pID49IDIgZWxzZSAnVW5rbm93bid9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ1BVCiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKCJwb3dlcnNoZWxsIEdldC1JdGVtUHJvcGVydHlWYWx1ZSAtUGF0aCAnSEtMTTpTeXN0ZW1cXEN1cnJlbnRDb250cm9sU2V0XFxDb250cm9sXFxTZXNzaW9uIE1hbmFnZXJcXEVudmlyb25tZW50JyAtTmFtZSBQUk9DRVNTT1JfSURFTlRJRklFUiIsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHNoZWxsPVRydWUpCiAgICAgICAgICAgIGluZm8uYXBwZW5kKGYiQ1BVOiB7cmVzdWx0LnN0ZG91dC5kZWNvZGUoZXJyb3JzPSdpZ25vcmUnKS5zdHJpcCgpfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFJBTQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bignd21pYyBjb21wdXRlcnN5c3RlbSBnZXQgdG90YWxwaHlzaWNhbG1lbW9yeScsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHNoZWxsPVRydWUpCiAgICAgICAgICAgIHJhbSA9IHJlc3VsdC5zdGRvdXQuZGVjb2RlKGVycm9ycz0naWdub3JlJykuc3RyaXAoKS5zcGxpdCgpCiAgICAgICAgICAgIGlmIGxlbihyYW0pID49IDE6CiAgICAgICAgICAgICAgICByYW1fZ2IgPSBpbnQoaW50KHJhbVsxXSkvMTAwMDAwMDAwMCkKICAgICAgICAgICAgICAgIGluZm8uYXBwZW5kKGYiUkFNOiB7cmFtX2difSBHQiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEdQVQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigid21pYyBwYXRoIHdpbjMyX1ZpZGVvQ29udHJvbGxlciBnZXQgbmFtZSIsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHNoZWxsPVRydWUpCiAgICAgICAgICAgIGdwdSA9IHJlc3VsdC5zdGRvdXQuZGVjb2RlKGVycm9ycz0naWdub3JlJykuc3BsaXRsaW5lcygpCiAgICAgICAgICAgIGluZm8uYXBwZW5kKGYiR1BVOiB7Z3B1WzJdLnN0cmlwKCkgaWYgbGVuKGdwdSkgPj0gMiBlbHNlICdVbmtub3duJ30iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBJUAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHVybG9wZW4oImh0dHA6Ly9pcC1hcGkuY29tL2pzb24vP2ZpZWxkcz1xdWVyeSxjb3VudHJ5LGNpdHkiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICBpcF9kYXRhID0ganNvbi5sb2FkcyhyZXNwb25zZS5yZWFkKCkuZGVjb2RlKCkpCiAgICAgICAgICAgICAgICBpbmZvLmFwcGVuZChmIklQOiB7aXBfZGF0YS5nZXQoJ3F1ZXJ5JywgJ1Vua25vd24nKX0iKQogICAgICAgICAgICAgICAgaW5mby5hcHBlbmQoZiJMb2NhdGlvbjoge2lwX2RhdGEuZ2V0KCdjaXR5JywgJycpfSwge2lwX2RhdGEuZ2V0KCdjb3VudHJ5JywgJycpfSIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGluZm8uYXBwZW5kKCJJUDogVW5hYmxlIHRvIGRldGVjdCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzeXN0ZW1fZmlsZSA9IG9zLnBhdGguam9pbihzZWxmLlRlbXBGb2xkZXIsICJzeXN0ZW1faW5mby50eHQiKQogICAgICAgICAgICB3aXRoIG9wZW4oc3lzdGVtX2ZpbGUsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuIi5qb2luKGluZm8pKQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5TeXN0ZW1JbmZvU3RvbGVuID0gVHJ1ZQogICAgICAgICAgICB0Z19sb2dnZXIuaW5mbygiU3lzdGVtIGluZm8gY29sbGVjdGVkIikKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICB0Z19sb2dnZXIuZXJyb3IoZiJTeXN0ZW0gaW5mbyBlcnJvcjoge2V9IikKICAgIAogICAgZGVmIFRha2VTY3JlZW5zaG90KHNlbGYpOgogICAgICAgIHRnX2xvZ2dlci5pbmZvKCJUYWtpbmcgc2NyZWVuc2hvdC4uLiIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmcm9tIGN0eXBlcyBpbXBvcnQgd2luZGxsCiAgICAgICAgICAgIGltcG9ydCBzdHJ1Y3QKICAgICAgICAgICAgCiAgICAgICAgICAgICMgR2V0IHNjcmVlbiBkaW1lbnNpb25zCiAgICAgICAgICAgIHVzZXIzMiA9IHdpbmRsbC51c2VyMzIKICAgICAgICAgICAgd2lkdGggPSB1c2VyMzIuR2V0U3lzdGVtTWV0cmljcygwKQogICAgICAgICAgICBoZWlnaHQgPSB1c2VyMzIuR2V0U3lzdGVtTWV0cmljcygxKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDYXB0dXJlIHNjcmVlbiB1c2luZyBjdHlwZXMKICAgICAgICAgICAgaGRjID0gdXNlcjMyLkdldERDKDApCiAgICAgICAgICAgIGdkaTMyID0gd2luZGxsLmdkaTMyCiAgICAgICAgICAgIAogICAgICAgICAgICBtZW1kYyA9IGdkaTMyLkNyZWF0ZUNvbXBhdGlibGVEQyhoZGMpCiAgICAgICAgICAgIGJpdG1hcCA9IGdkaTMyLkNyZWF0ZUNvbXBhdGlibGVCaXRtYXAoaGRjLCB3aWR0aCwgaGVpZ2h0KQogICAgICAgICAgICBnZGkzMi5TZWxlY3RPYmplY3QobWVtZGMsIGJpdG1hcCkKICAgICAgICAgICAgZ2RpMzIuQml0Qmx0KG1lbWRjLCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCBoZGMsIDAsIDAsIDB4MDBDQzAwMjApCiAgICAgICAgICAgIAogICAgICAgICAgICAjIENyZWF0ZSBCTVAgZmlsZQogICAgICAgICAgICBibXBfaGVhZGVyID0gc3RydWN0LnBhY2soJzwyc0lISEknLCBiJ0JNJywgNTQgKyB3aWR0aCAqIGhlaWdodCAqIDMsIDAsIDAsIDU0KQogICAgICAgICAgICBkaWJfaGVhZGVyID0gc3RydWN0LnBhY2soJzxJSUlISElJSUlJSScsIDQwLCB3aWR0aCwgaGVpZ2h0LCAxLCAyNCwgMCwgd2lkdGggKiBoZWlnaHQgKiAzLCAwLCAwLCAwLCAwKQogICAgICAgICAgICAKICAgICAgICAgICAgIyBHZXQgYml0bWFwIGJpdHMKICAgICAgICAgICAgYnVmZmVyID0gY3R5cGVzLmNyZWF0ZV9zdHJpbmdfYnVmZmVyKHdpZHRoICogaGVpZ2h0ICogNCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGNsYXNzIEJJVE1BUElORk9IRUFERVIoY3R5cGVzLlN0cnVjdHVyZSk6CiAgICAgICAgICAgICAgICBfZmllbGRzXyA9IFsoJ2JpU2l6ZScsIGN0eXBlcy5jX3Vsb25nKSwgKCdiaVdpZHRoJywgY3R5cGVzLmNfbG9uZyksICgnYmlIZWlnaHQnLCBjdHlwZXMuY19sb25nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgKCdiaVBsYW5lcycsIGN0eXBlcy5jX3VzaG9ydCksICgnYmlCaXRDb3VudCcsIGN0eXBlcy5jX3VzaG9ydCksICgnYmlDb21wcmVzc2lvbicsIGN0eXBlcy5jX3Vsb25nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgKCdiaVNpemVJbWFnZScsIGN0eXBlcy5jX3Vsb25nKSwgKCdiaVhQZWxzUGVyTWV0ZXInLCBjdHlwZXMuY19sb25nKSwgKCdiaVlQZWxzUGVyTWV0ZXInLCBjdHlwZXMuY19sb25nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgKCdiaUNsclVzZWQnLCBjdHlwZXMuY191bG9uZyksICgnYmlDbHJJbXBvcnRhbnQnLCBjdHlwZXMuY191bG9uZyldCiAgICAgICAgICAgIAogICAgICAgICAgICBiaSA9IEJJVE1BUElORk9IRUFERVIoKQogICAgICAgICAgICBiaS5iaVNpemUgPSA0MAogICAgICAgICAgICBiaS5iaVdpZHRoID0gd2lkdGgKICAgICAgICAgICAgYmkuYmlIZWlnaHQgPSAtaGVpZ2h0CiAgICAgICAgICAgIGJpLmJpUGxhbmVzID0gMQogICAgICAgICAgICBiaS5iaUJpdENvdW50ID0gMzIKICAgICAgICAgICAgCiAgICAgICAgICAgIGdkaTMyLkdldERJQml0cyhtZW1kYywgYml0bWFwLCAwLCBoZWlnaHQsIGJ1ZmZlciwgY3R5cGVzLmJ5cmVmKGJpKSwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2xlYW51cAogICAgICAgICAgICBnZGkzMi5EZWxldGVPYmplY3QoYml0bWFwKQogICAgICAgICAgICBnZGkzMi5EZWxldGVEQyhtZW1kYykKICAgICAgICAgICAgdXNlcjMyLlJlbGVhc2VEQygwLCBoZGMpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFNhdmUgYXMgc2ltcGxlIGZvcm1hdAogICAgICAgICAgICBzY3JlZW5zaG90X2ZpbGUgPSBvcy5wYXRoLmpvaW4oc2VsZi5UZW1wRm9sZGVyLCAic2NyZWVuc2hvdC5ibXAiKQogICAgICAgICAgICB3aXRoIG9wZW4oc2NyZWVuc2hvdF9maWxlLCAid2IiKSBhcyBmOgogICAgICAgICAgICAgICAgIyBXcml0ZSBhIHNpbXBsZSBCTVAKICAgICAgICAgICAgICAgIGYud3JpdGUoYnVmZmVyLnJhdykKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuU2NyZWVuc2hvdFRha2VuID0gVHJ1ZQogICAgICAgICAgICB0Z19sb2dnZXIuaW5mbygiU2NyZWVuc2hvdCBjYXB0dXJlZCIpCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgdGdfbG9nZ2VyLndhcm5pbmcoZiJTY3JlZW5zaG90IGVycm9yOiB7ZX0iKQogICAgCiAgICBkZWYgQ3JlYXRlQXJjaGl2ZShzZWxmKSAtPiBzdHI6CiAgICAgICAgdGdfbG9nZ2VyLmluZm8oIkNyZWF0aW5nIGFyY2hpdmUuLi4iKQogICAgICAgIAogICAgICAgIGFyY2hpdmVfcGF0aCA9IG9zLnBhdGguam9pbihvcy5nZXRlbnYoInRlbXAiKSwgZiJTdGFyU3RlYWxlcl97b3MuZ2V0bG9naW4oKX0uemlwIikKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGltcG9ydCB6aXBmaWxlCiAgICAgICAgICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKGFyY2hpdmVfcGF0aCwgJ3cnLCB6aXBmaWxlLlpJUF9ERUZMQVRFRCkgYXMgemlwZjoKICAgICAgICAgICAgICAgIGZvciByb290LCBkaXJzLCBmaWxlcyBpbiBvcy53YWxrKHNlbGYuVGVtcEZvbGRlcik6CiAgICAgICAgICAgICAgICAgICAgZm9yIGZpbGUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihyb290LCBmaWxlKQogICAgICAgICAgICAgICAgICAgICAgICBhcmNuYW1lID0gb3MucGF0aC5yZWxwYXRoKGZpbGVfcGF0aCwgc2VsZi5UZW1wRm9sZGVyKQogICAgICAgICAgICAgICAgICAgICAgICB6aXBmLndyaXRlKGZpbGVfcGF0aCwgYXJjbmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHRnX2xvZ2dlci5pbmZvKGYiQXJjaGl2ZSBjcmVhdGVkOiB7YXJjaGl2ZV9wYXRofSIpCiAgICAgICAgICAgIHJldHVybiBhcmNoaXZlX3BhdGgKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHRnX2xvZ2dlci5lcnJvcihmIkFyY2hpdmUgY3JlYXRpb24gZXJyb3I6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGRlZiBTZW5kRGF0YShzZWxmKToKICAgICAgICB0Z19sb2dnZXIuaW5mbygiU2VuZGluZyBkYXRhIHRvIFRlbGVncmFtLi4uIikKICAgICAgICAKICAgICAgICBhcmNoaXZlX3BhdGggPSBzZWxmLkNyZWF0ZUFyY2hpdmUoKQogICAgICAgIAogICAgICAgIGlmIGFyY2hpdmVfcGF0aCBhbmQgb3MucGF0aC5pc2ZpbGUoYXJjaGl2ZV9wYXRoKToKICAgICAgICAgICAgIyDQodC+0LHQuNGA0LDQtdC8INC40L3RhNC+0YDQvNCw0YbQuNGOINC+INGB0LjRgdGC0LXQvNC1CiAgICAgICAgICAgIGNvbXB1dGVyX25hbWUgPSBvcy5nZXRlbnYoImNvbXB1dGVybmFtZSIsICJVbmtub3duIikKICAgICAgICAgICAgdXNlcm5hbWUgPSBvcy5nZXRsb2dpbigpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHVybG9wZW4oImh0dHA6Ly9pcC1hcGkuY29tL2pzb24vP2ZpZWxkcz1xdWVyeSxjb3VudHJ5LGNpdHkiLCB0aW1lb3V0PTUpCiAgICAgICAgICAgICAgICBpcF9kYXRhID0ganNvbi5sb2FkcyhyZXNwb25zZS5yZWFkKCkuZGVjb2RlKCkpCiAgICAgICAgICAgICAgICBpcF9pbmZvID0gZiJ7aXBfZGF0YS5nZXQoJ3F1ZXJ5JywgJ1Vua25vd24nKX0gKHtpcF9kYXRhLmdldCgnY291bnRyeScsICcnKX0pIgogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBpcF9pbmZvID0gIlVua25vd24iCiAgICAgICAgICAgIAogICAgICAgICAgICBjYXB0aW9uID0gKAogICAgICAgICAgICAgICAgZiLwn46vIFN0YXIgU3RlYWxlciBMb2dcblxuIgogICAgICAgICAgICAgICAgZiLwn5GkIFVzZXI6IHt1c2VybmFtZX1cbiIKICAgICAgICAgICAgICAgIGYi8J+SuyBQQzoge2NvbXB1dGVyX25hbWV9XG4iCiAgICAgICAgICAgICAgICBmIvCfjJAgSVA6IHtpcF9pbmZvfVxuXG4iCiAgICAgICAgICAgICAgICBmIvCfk4ogUGFzc3dvcmRzOiB7c2VsZi5QYXNzd29yZHNDb3VudH1cbiIKICAgICAgICAgICAgICAgIGYi8J+NqiBDb29raWVzOiB7c2VsZi5Db29raWVzQ291bnR9XG4iCiAgICAgICAgICAgICAgICBmIvCfk7YgV2lGaToge3NlbGYuV2lmaVBhc3N3b3Jkc0NvdW50fVxuIgogICAgICAgICAgICAgICAgZiLwn5OxIFRlbGVncmFtOiB7c2VsZi5UZWxlZ3JhbVNlc3Npb25zQ291bnR9IgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINCe0YLQv9GA0LDQstC70Y/QtdC8INCw0YDRhdC40LIKICAgICAgICAgICAgaWYgdGdfbG9nZ2VyLnNlbmRfZmlsZShhcmNoaXZlX3BhdGgsIGNhcHRpb24pOgogICAgICAgICAgICAgICAgdGdfbG9nZ2VyLmluZm8oIkRhdGEgc2VudCBzdWNjZXNzZnVsbHkhIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHRnX2xvZ2dlci5lcnJvcigiRmFpbGVkIHRvIHNlbmQgZGF0YSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINCj0LTQsNC70Y/QtdC8INCw0YDRhdC40LIKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGFyY2hpdmVfcGF0aCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgCiAgICBkZWYgQ2xlYW51cChzZWxmKToKICAgICAgICB0Z19sb2dnZXIuaW5mbygiQ2xlYW5pbmcgdXAuLi4iKQogICAgICAgIHRyeToKICAgICAgICAgICAgc2h1dGlsLnJtdHJlZShzZWxmLlRlbXBGb2xkZXIsIGlnbm9yZV9lcnJvcnM9VHJ1ZSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCgpkZWYgbWFpbigpOgogICAgcHJpbnQoIj0iICogNTApCiAgICBwcmludCgiU3RhciBTdGVhbGVyIC0gVGVsZWdyYW0gRWRpdGlvbiIpCiAgICBwcmludCgiPSIgKiA1MCkKICAgIAogICAgIyDQn9GA0L7QstC10YDRj9C10Lwg0J7QoQogICAgaWYgb3MubmFtZSAhPSAibnQiOgogICAgICAgIHByaW50KCJbRVJST1JdIFRoaXMgc2NyaXB0IG9ubHkgd29ya3Mgb24gV2luZG93cyEiKQogICAgICAgIHJldHVybgogICAgCiAgICAjINCf0YDQvtCy0LXRgNGP0LXQvCDQuNC90YLQtdGA0L3QtdGCCiAgICBpZiBub3QgVXRpbGl0eS5Jc0Nvbm5lY3RlZFRvSW50ZXJuZXQoKToKICAgICAgICBwcmludCgiW0VSUk9SXSBObyBpbnRlcm5ldCBjb25uZWN0aW9uISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgICMg0J/RgNC+0LLQtdGA0Y/QtdC8IG11dGV4ICjRh9GC0L7QsdGLINC90LUg0LfQsNC/0YPRgdC60LDQu9GB0Y8g0LTQstCw0LbQtNGLKQogICAgaWYgbm90IFN5c2NhbGxzLkNyZWF0ZU11dGV4KFNldHRpbmdzLk11dGV4KToKICAgICAgICBwcmludCgiW0VSUk9SXSBBbHJlYWR5IHJ1bm5pbmchIikKICAgICAgICByZXR1cm4KICAgIAogICAgIyDQodC60YDRi9Cy0LDQtdC8INC60L7QvdGB0L7Qu9GMINC10YHQu9C4INC90YPQttC90L4KICAgIGlmIFNldHRpbmdzLkhpZGVDb25zb2xlOgogICAgICAgIFN5c2NhbGxzLkhpZGVDb25zb2xlKCkKICAgIAogICAgIyDQl9Cw0L/Rg9GB0LrQsNC10Lwg0YHQsdC+0YDRidC40LoKICAgIFN0YXJTdGVhbGVyKCkKICAgIAogICAgcHJpbnQoIlxuW0RPTkVdIEV4ZWN1dGlvbiBjb21wbGV0ZWQhIikKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgbWFpbigpCg==").decode("utf-8"))
